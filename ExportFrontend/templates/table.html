<!DOCTYPE html>
{% macro table_with_buttons(id="databasetable", column_names=[], table=[] )%}
<script>
    $(document).ready(function () {

        var oTable = $("#{{id}}").DataTable({
            "dom": 'Blfrtip',
            "colReorder": true,
            "responsive": true,
            "processing": true,
            "buttons": [
                {
                    extend: 'collection',
                    className: 'btn btn-outline-primary mb-2',
                    text: 'Export Table',
                    buttons: [
                        { extend: 'copy', className: 'btn btn-secondary mb-2' },
                        { extend: 'csv', className: 'btn btn-secondary mb-2' },
                        { extend: 'excel', className: 'btn btn-secondary mb-2' },
                        { extend: 'pdf', className: 'btn btn-secondary mb-2' },
                        { extend: 'print', className: 'btn btn-secondary mb-2' },
                    ]
                },

            ],
            "search": {
                "regex": true
            }
        });
        oTable.buttons().container()
            .appendTo('#{{id}}_wrapper .col-md-6:eq(0)')
        $('#{{id}} tbody').on('click', 'tr', function () {
            $(this).toggleClass('selected');
        });
        function getSelected() {
            var selected = [];
            $('#{{id}} tbody tr.selected').each(function () {
                var pos = oTable.row(this).index();
                var row = oTable.row(pos).data();
                var id_name = row[5];
                selected.push(id_name);
            });
            return selected;
        }
        $("#btnName{{id}}").on("click", function () {
            var oAll = getSelected();
            var conf = confirm("Do you want to delete the folowing Names? \n" + oAll);
            if (conf == false) {
                alert("No Data has been Deleted")
            }
            if (conf == true) {
                $.ajax({
                    type: "POST",
                    url: "delete_batch_name_array",
                    data: { 'data': JSON.stringify(oAll) }
                });
                location.reload();
            }
        });
        $("#btnID{{id}}").on("click", function () {
            var oAll = getSelected();
            var conf = confirm("Do you want to delete the folowing IDs? \n" + oAll);
            if (conf == false) {
                alert("No Data has been Deleted")
            }
            if (conf == true) {
                $.ajax({
                    type: "POST",
                    url: "delete_batch_id_array",
                    data: { 'data': JSON.stringify(oAll) }
                });
                location.reload();
            }
        });
        $("#btnbetweenids{{id}}").on("click", function () {
            var oAll = getSelected();
            if (oAll.length > 1) {
                var conf = confirm("Do you want to delete the batches between the following IDs? \n" + oAll);
                if (conf == false) {
                    alert("No Data has been Deleted")
                }
                if (conf == true) {
                    $.ajax({
                        type: "POST",
                        url: "delete_between_ids",
                        data: { 'data': JSON.stringify(oAll) }
                    });
                    location.reload();
                }
            }
            else {
                alert("Please select 2 or more Values")
            }
        });
        $('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
            $($.fn.dataTable.tables(true)).DataTable()
                .columns.adjust()
                .fixedColumns().relayout();
        });
    });

</script>
<table class="table table-striped table-bordered" id="{{id}}" style="width: 100%">
    <thead>
        <tr>
            {% for name in column_names %}
            <th> {{ name }}</th>
            {% endfor %}
        </tr>
    </thead>
    <tbody>
        {% for table_object in table %}
        <tr>
            {% for name in column_names %}
            <td> {{ table_object[name] }}</td>
            {% endfor %}
        </tr>
        {% endfor %}

    </tbody>
</table>
{% endmacro %}

{% macro ajax_table(table_name="table_name", parameters = "parameters" ) %}
<script>
    $(document).ready(function () {
        var parameters = $.param(JSON.parse('{{parameters|tojson}}'), true);

        $.ajax({
            "url": "{{url_for('table_interface.get_table_rows', table_name=table_name)}}",
            "data": parameters,
            success: function (data) {
                var columns = [];
                columnNames = Object.keys(data.data[0]);
                for (var i in columnNames) {
                    columns.push({
                        data: columnNames[i],
                        title: columnNames[i],
                        name: columnNames[i]
                    });
                }
                var oTable = $("#{{table_name}}").DataTable({

                    "autoWidth": true,
                    "buttons": [
                        {
                            extend: 'collection',
                            className: 'btn btn-outline-primary mb-2',
                            text: 'Export Table',
                            buttons: [
                                { extend: 'copy', className: 'btn btn-secondary mb-2' },
                                { extend: 'csv', className: 'btn btn-secondary mb-2' },
                                { extend: 'excel', className: 'btn btn-secondary mb-2' },
                                { extend: 'pdf', className: 'btn btn-secondary mb-2' },
                                { extend: 'print', className: 'btn btn-secondary mb-2' },
                            ]
                        },
                        { extend: 'colvis', className: 'btn btn-outline-primary mb-2', collectionLayout: 'four-column' },
                        {
                            text: 'View Templates', className: 'btn btn-outline-primary mb-2',
                            action: function () {
                                showModal('#{{table_name}}Modal')
                            }
                        }
                    ],
                    "columns": columns,
                    "colReorder": true,
                    "data": data.data,
                    "orderMuli": true,
                    "processing": true,
                    "dom": '<"row"<"col-sm-12 col-md-6"B><"col-sm-12 col-md-6"l>> rt <"row"<"col-sm-12 col-md-6"i><"col-sm-12 col-md-6"p>>',
                    "responsive": true,
                    "stateSave": true,
                    "select": {
                        style: 'multi'
                    }
                });
            }
        });
    });


    function showModal(id) {
        $.ajax({
            url: "{{url_for('view_templates.all_view_templates')}}",
            success: function (data) {
                var modalTable = $("#{{table_name}}ModalTable").DataTable({
                    "autoWidth": true,
                    "columns": [
                        { data: "id", title: "id", name: "id" },
                        { data: "viewname", title: "viewname", name: "viewname" },
                        { data: "defaultrowcount", title: "defaultrowcount", name: "defaultrowcount" }
                    ],
                    "colReorder": true,
                    "data": data.data,
                    "destroy": true,
                    "orderMuli": true,
                    "processing": true,
                    "responsive": true,
                    "select": {
                        style: 'single' 
                    }
                });
            }
        });
        $(id).modal('toggle')
    }

    function hideModals() {
        $('.modal').modal('toggle')
    }


</script>
<div class="modal fade" id="{{table_name}}Modal" tabindex="-1" role="dialog" aria-labelledby="{{table_name}}ModalLabel"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Modal title</h5>
                <button type="button" class="close" onclick="hideModals()" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <table class="table" id="{{table_name}}ModalTable" style="width: 100%">
                </table>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary">Save changes</button>
                <button type="button" class="btn btn-secondary" onclick="hideModals()">Close</button>
            </div>
        </div>
    </div>
</div>
<table class="table" id="{{table_name}}" style="width: 100%">
</table>
{% endmacro %}